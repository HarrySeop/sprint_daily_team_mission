# π HTTP λ©”μ„λ“μ™€ λ©±λ“±μ„±(Idempotency)

## β… 1. λ©±λ“±μ„±μ΄λ€?

### π“ μ •μ

- λ©±λ“±μ„±(Idempotency)μ΄λ€ **κ°™μ€ μ”μ²­μ„ μ—¬λ¬ λ² μν–‰ν•΄λ„ κ²°κ³Όκ°€ λ™μΌν• μ„±μ§**μ„ μλ―Έν•©λ‹λ‹¤.
- μν•™μ  μ •μ: `f(f(x)) = f(x)`

### β… μμ‹

- **DELETE /users/1** β†’ μ²« μ”μ²­μ—μ„ μ‚¬μ©μ μ‚­μ , μ΄ν›„ μ”μ²­μ€ μ‚­μ λ μƒνƒ μ μ§€ β†’ κ²°κ³Ό λ™μΌ β†’ β… λ©±λ“±ν•¨
- **POST /users** β†’ κ°™μ€ μ”μ²­μ„ λ‘ λ² λ³΄λ‚΄λ©΄ μ‚¬μ©μ λ‘ λ… μƒμ„± β†’ β λ©±λ“±ν•μ§€ μ•μ

### β… μ™ μ¤‘μ”ν•κ°€?

- λ„¤νΈμ›ν¬ μ¥μ• λ‚ μ‚¬μ©μ μ¤μ‘λ™(μ: μƒλ΅κ³ μΉ¨, μ¤‘λ³µ ν΄λ¦­ λ“±)μΌλ΅ μΈν•΄ **λ™μΌν• μ”μ²­μ΄ μ—¬λ¬ λ² μ„λ²„μ— μ „λ‹¬**λ  μ μμµλ‹λ‹¤.
- μ΄λ• λ©±λ“±μ„±μ΄ λ³΄μ¥λλ©΄ μ„λ²„ μƒνƒκ°€ λ¶μ•μ •ν•΄μ§€κ±°λ‚ **μ¤‘λ³µ λ°μ΄ν„°κ°€ μƒμ„±λλ” λ¬Έμ λ¥Ό λ°©μ§€**ν•  μ μμµλ‹λ‹¤.

### π“ μ‹¤μ©μ  μμ‹

- **κ²°μ  μ”μ²­ API**: `POST /payments` μ”μ²­μ΄ μ¤‘λ³µλλ©΄ μ¤‘λ³µ κ²°μ κ°€ λ°μƒν•  μ μμ β†’ β… λ©±λ“±ν‚¤(idempotency key) λ“±μ„ ν†µν•΄ μ¤‘λ³µ κ²°μ  λ°©μ§€ ν•„μ”
- **νμ› νƒν‡΄ μ”μ²­**: λ™μΌν• `DELETE /users/me` μ”μ²­μ΄ μ—¬λ¬ λ² λ³΄λ‚΄μ Έλ„ μ •μƒ λ™μ‘ν•΄μ•Ό ν•¨

---

## β™οΈ HTTP λ©”μ„λ“ μ†μ„±

| μ†μ„±                 | μ„¤λ…                                                                        |
| -------------------- | --------------------------------------------------------------------------- |
| μ•μ „(Safe)           | μ„λ²„μ μƒνƒλ‚ λ¦¬μ†μ¤λ¥Ό λ³€κ²½ν•μ§€ μ•μ (μ: GET, HEAD)                        |
| λ©±λ“±μ„±(Idempotent)   | λ™μΌν• μ”μ²­μ„ μ—¬λ¬ λ² λ³΄λ‚΄λ„ κ°™μ€ κ²°κ³Όλ¥Ό λ°ν™ (μ: GET, PUT, DELETE)        |
| μΊμ‹ κ°€λ¥(Cacheable) | μ‘λ‹µμ„ ν΄λΌμ΄μ–ΈνΈ λλ” ν”„λ΅μ‹μ—μ„ μ €μ¥ν•  μ μμ (μ: GET, HEAD, μΌλ¶€ POST) |

---

## β… 2. μ£Όμ” HTTP λ©”μ„λ“ μ •λ¦¬

### πΆ GET (μ΅°ν)

- λ¦¬μ†μ¤λ¥Ό μ΅°νν•  λ• μ‚¬μ©
- μ„λ²„μ μƒνƒλ‚ λ¦¬μ†μ¤λ¥Ό λ³€κ²½ν•μ§€ μ•μ
- β… μ•μ „ν•¨
- β… λ©±λ“±ν•¨
- β… μΊμ‹ κ°€λ¥

```http
GET /members/1
```

---

### πΆ POST (μƒμ„±)

- μ„λ²„μ— λ°μ΄ν„°λ¥Ό μ „μ†΅ν•μ—¬ **μƒλ΅μ΄ λ¦¬μ†μ¤λ¥Ό μƒμ„±**ν•κ±°λ‚ μ²λ¦¬ μ”μ²­
- μ”μ²­λ§λ‹¤ κ²°κ³Όκ°€ λ‹¬λΌμ§ μ μμ
- β λ©±λ“±ν•μ§€ μ•μ
- β μ•μ „ν•μ§€ μ•μ
- π”Έ μΊμ‹ λΉ„κ¶μ¥

```http
POST /members
{
  "name": "newUser"
}
```

---

### π΅ PUT (μ „μ²΄ μμ • λλ” μƒμ„±)

- ν•΄λ‹Ή URIμ λ¦¬μ†μ¤λ¥Ό **μ „μ²΄ λ€μ²΄** λλ” μ—†μΌλ©΄ **μƒμ„±**
- κ°™μ€ μ”μ²­μ„ λ°λ³µν•΄λ„ κ²°κ³Ό λ™μΌ β†’ β… λ©±λ“±ν•¨

```http
PUT /members/1
{
  "id": "1",
  "name": "updatedUser"
}
```

---

### π  PATCH (λ¶€λ¶„ μμ •)

- λ¦¬μ†μ¤μ **μΌλ¶€ μ†μ„±λ§ μμ •**
- μ”μ²­λ§λ‹¤ κ²°κ³Όκ°€ λ‹¬λΌμ§ μ μμ β†’ β λ©±λ“±ν•μ§€ μ•μ (μ‹¤μ  κµ¬ν„μ— λ”°λΌ λ‹¤λ¥Ό μ μμ)

```http
PATCH /members/1
{
  "name": "patchedName"
}
```

---

### π”΄ DELETE (μ‚­μ )

- λ¦¬μ†μ¤λ¥Ό μ‚­μ 
- μ—¬λ¬ λ² μ”μ²­ν•΄λ„ μ‚­μ λ μƒνƒλ” μ μ§€ β†’ β… λ©±λ“±ν•¨

```http
DELETE /members/1
```

---

### π” POST vs PUT μ°¨μ΄μ 

| ν•­λ©      | POST                                  | PUT                                    |
| --------- | ------------------------------------- | -------------------------------------- |
| λ©μ       | λ¦¬μ†μ¤ μƒμ„± λλ” μ²λ¦¬                 | λ¦¬μ†μ¤ μ „μ²΄ μμ • λλ” μƒμ„±             |
| URI κ²°μ •  | μ„λ²„κ°€ URI μƒμ„±                       | ν΄λΌμ΄μ–ΈνΈκ°€ URI μ§€μ •                  |
| λ©±λ“±μ„±    | β (μ”μ²­λ§λ‹¤ μƒλ΅μ΄ λ¦¬μ†μ¤ μƒμ„± κ°€λ¥) | β… (κ°™μ€ μ”μ²­ λ°λ³µν•΄λ„ λ™μΌ μƒνƒ μ μ§€) |
| μ‚¬μ© μμ‹ | νμ› λ“±λ΅, κ²μ‹κΈ€ μƒμ„±                | νμ› μ •λ³΄ μ „μ²΄ μμ •, λ¬Έμ„ λ®μ–΄μ“°κΈ°     |

**μ”μ•½**: POSTλ” λ™μ‘ λ°©μ‹μ΄ μ •ν•΄μ§€μ§€ μ•μ•κ³ , μ”μ²­λ§λ‹¤ κ²°κ³Όκ°€ λ‹¬λΌμ§ μ μμµλ‹λ‹¤. λ°λ©΄ PUTμ€ κ°™μ€ URIμ— λ™μΌν• λ°μ΄ν„°λ¥Ό λ³΄λ‚΄λ©΄ ν•­μƒ κ°™μ€ κ²°κ³Όλ¥Ό λ³΄μ¥ν•©λ‹λ‹¤.

---

## π” λ©±λ“±μ„± μ •λ¦¬ν‘

| λ©”μ„λ“ | μ•μ „μ„±(Safe) | λ©±λ“±μ„±(Idempotent) | μΊμ‹ κ°€λ¥(Cacheable)        |
| ------ | ------------ | ------------------ | --------------------------- |
| GET    | β…           | β…                 | β…                          |
| POST   | β           | β                 | π”Έ μ ν•μ  (κ±°μ μ‚¬μ© μ• ν•¨) |
| PUT    | β           | β…                 | π”Έ κ°€λ¥                     |
| PATCH  | β           | β (λ³΄ν†µ)          | β                          |
| DELETE | β           | β…                 | β                          |

![HTTP λ©”μ†λ“ μ†μ„±ν‘](https://github.com/YehyeokBang/TIL/raw/main/HTTP/%EB%AA%A8%EB%93%A0%20%EA%B0%9C%EB%B0%9C%EC%9E%90%EB%A5%BC%20%EC%9C%84%ED%95%9C%20HTTP%20%EC%9B%B9%20%EA%B8%B0%EB%B3%B8%20%EC%A7%80%EC%8B%9D/images/httpMethod.png)

---

## β… 3. HTTP μƒνƒ μ½”λ“ κ°„λµ μ •λ¦¬

| μƒνƒ μ½”λ“                   | μλ―Έ                          | μ„¤λ…                            |
| --------------------------- | ----------------------------- | ------------------------------- |
| `200 OK`                    | μ”μ²­ μ„±κ³µ                     | μ£Όλ΅ GET, PUT, DELETE μ”μ²­ μ‘λ‹µ |
| `201 Created`               | λ¦¬μ†μ¤ μƒμ„± μ™„λ£              | POST μ”μ²­ μ‹ μƒ λ¦¬μ†μ¤ μƒμ„±λ¨   |
| `204 No Content`            | μ„±κ³µν–μ§€λ§ λ°ν™ν•  μ½ν…μΈ  μ—†μ | DELETE μ„±κ³µ μ‘λ‹µ λ“±             |
| `400 Bad Request`           | μλ»λ μ”μ²­                   | ν΄λΌμ΄μ–ΈνΈ νλΌλ―Έν„° μ¤λ¥ λ“±     |
| `401 Unauthorized`          | μΈμ¦ μ‹¤ν¨                     | ν† ν° μ—†μ, λ΅κ·ΈμΈ ν•„μ” λ“±       |
| `403 Forbidden`             | κ¶ν• μ—†μ                     | μΈμ¦μ€ λμ—μ§€λ§ μ ‘κ·Ό κΈμ§€       |
| `404 Not Found`             | λ¦¬μ†μ¤ μ—†μ                   | μλ»λ κ²½λ΅ λ“±                  |
| `500 Internal Server Error` | μ„λ²„ μ¤λ¥                     | μμ™Έ λ°μƒ, μ„λ²„ λ‚΄λ¶€ λ¬Έμ        |

---

### π“ μ°Έκ³  μλ£

- [MDN - λ©±λ“±μ„±](https://developer.mozilla.org/ko/docs/Glossary/Idempotent)
- [HTTP λ©”μ„λ“ - μ„ν‚¤λ°±κ³Ό](https://ko.wikipedia.org/wiki/HTTP)
- [λ©±λ“±μ„±μ΄ λ­”κ°€μ”?](https://docs.tosspayments.com/blog/what-is-idempotency)
