# 🌐 HTTP 메서드와 멱등성(Idempotency)

## ✅ 1. 멱등성이란?

### 📌 정의

- 멱등성(Idempotency)이란 **같은 요청을 여러 번 수행해도 결과가 동일한 성질**을 의미합니다.
- 수학적 정의: `f(f(x)) = f(x)`

### ✅ 예시

- **DELETE /users/1** → 첫 요청에서 사용자 삭제, 이후 요청은 삭제된 상태 유지 → 결과 동일 → ✅ 멱등함
- **POST /users** → 같은 요청을 두 번 보내면 사용자 두 명 생성 → ❌ 멱등하지 않음

### ✅ 왜 중요한가?

- 네트워크 장애나 사용자 오작동(예: 새로고침, 중복 클릭 등)으로 인해 **동일한 요청이 여러 번 서버에 전달**될 수 있습니다.
- 이때 멱등성이 보장되면 서버 상태가 불안정해지거나 **중복 데이터가 생성되는 문제를 방지**할 수 있습니다.

### 📌 실용적 예시

- **결제 요청 API**: `POST /payments` 요청이 중복되면 중복 결제가 발생할 수 있음 → ✅ 멱등키(idempotency key) 등을 통해 중복 결제 방지 필요
- **회원 탈퇴 요청**: 동일한 `DELETE /users/me` 요청이 여러 번 보내져도 정상 동작해야 함

---

## ⚙️ HTTP 메서드 속성

| 속성                 | 설명                                                                        |
| -------------------- | --------------------------------------------------------------------------- |
| 안전(Safe)           | 서버의 상태나 리소스를 변경하지 않음 (예: GET, HEAD)                        |
| 멱등성(Idempotent)   | 동일한 요청을 여러 번 보내도 같은 결과를 반환 (예: GET, PUT, DELETE)        |
| 캐시 가능(Cacheable) | 응답을 클라이언트 또는 프록시에서 저장할 수 있음 (예: GET, HEAD, 일부 POST) |

---

## ✅ 2. 주요 HTTP 메서드 정리

### 🟢 GET (조회)

- 리소스를 조회할 때 사용
- 서버의 상태나 리소스를 변경하지 않음
- ✅ 안전함
- ✅ 멱등함
- ✅ 캐시 가능

```http
GET /members/1
```

---

### 🟢 POST (생성)

- 서버에 데이터를 전송하여 **새로운 리소스를 생성**하거나 처리 요청
- 요청마다 결과가 달라질 수 있음
- ❌ 멱등하지 않음
- ❌ 안전하지 않음
- 🔸 캐시 비권장

```http
POST /members
{
  "name": "newUser"
}
```

---

### 🟡 PUT (전체 수정 또는 생성)

- 해당 URI의 리소스를 **전체 대체** 또는 없으면 **생성**
- 같은 요청을 반복해도 결과 동일 → ✅ 멱등함

```http
PUT /members/1
{
  "id": "1",
  "name": "updatedUser"
}
```

---

### 🟠 PATCH (부분 수정)

- 리소스의 **일부 속성만 수정**
- 요청마다 결과가 달라질 수 있음 → ❌ 멱등하지 않음 (실제 구현에 따라 다를 수 있음)

```http
PATCH /members/1
{
  "name": "patchedName"
}
```

---

### 🔴 DELETE (삭제)

- 리소스를 삭제
- 여러 번 요청해도 삭제된 상태는 유지 → ✅ 멱등함

```http
DELETE /members/1
```

---

### 🔍 POST vs PUT 차이점

| 항목      | POST                                  | PUT                                    |
| --------- | ------------------------------------- | -------------------------------------- |
| 목적      | 리소스 생성 또는 처리                 | 리소스 전체 수정 또는 생성             |
| URI 결정  | 서버가 URI 생성                       | 클라이언트가 URI 지정                  |
| 멱등성    | ❌ (요청마다 새로운 리소스 생성 가능) | ✅ (같은 요청 반복해도 동일 상태 유지) |
| 사용 예시 | 회원 등록, 게시글 생성                | 회원 정보 전체 수정, 문서 덮어쓰기     |

**요약**: POST는 동작 방식이 정해지지 않았고, 요청마다 결과가 달라질 수 있습니다. 반면 PUT은 같은 URI에 동일한 데이터를 보내면 항상 같은 결과를 보장합니다.

---

## 🔁 멱등성 정리표

| 메서드 | 안전성(Safe) | 멱등성(Idempotent) | 캐시 가능(Cacheable)        |
| ------ | ------------ | ------------------ | --------------------------- |
| GET    | ✅           | ✅                 | ✅                          |
| POST   | ❌           | ❌                 | 🔸 제한적 (거의 사용 안 함) |
| PUT    | ❌           | ✅                 | 🔸 가능                     |
| PATCH  | ❌           | ❌ (보통)          | ❌                          |
| DELETE | ❌           | ✅                 | ❌                          |

![HTTP 메소드 속성표](https://github.com/YehyeokBang/TIL/raw/main/HTTP/%EB%AA%A8%EB%93%A0%20%EA%B0%9C%EB%B0%9C%EC%9E%90%EB%A5%BC%20%EC%9C%84%ED%95%9C%20HTTP%20%EC%9B%B9%20%EA%B8%B0%EB%B3%B8%20%EC%A7%80%EC%8B%9D/images/httpMethod.png)

---

## ✅ 3. HTTP 상태 코드 간략 정리

| 상태 코드                   | 의미                          | 설명                            |
| --------------------------- | ----------------------------- | ------------------------------- |
| `200 OK`                    | 요청 성공                     | 주로 GET, PUT, DELETE 요청 응답 |
| `201 Created`               | 리소스 생성 완료              | POST 요청 시 새 리소스 생성됨   |
| `204 No Content`            | 성공했지만 반환할 콘텐츠 없음 | DELETE 성공 응답 등             |
| `400 Bad Request`           | 잘못된 요청                   | 클라이언트 파라미터 오류 등     |
| `401 Unauthorized`          | 인증 실패                     | 토큰 없음, 로그인 필요 등       |
| `403 Forbidden`             | 권한 없음                     | 인증은 되었지만 접근 금지       |
| `404 Not Found`             | 리소스 없음                   | 잘못된 경로 등                  |
| `500 Internal Server Error` | 서버 오류                     | 예외 발생, 서버 내부 문제       |

---

### 📚 참고 자료

- [MDN - 멱등성](https://developer.mozilla.org/ko/docs/Glossary/Idempotent)
- [HTTP 메서드 - 위키백과](https://ko.wikipedia.org/wiki/HTTP)
- [멱등성이 뭔가요?](https://docs.tosspayments.com/blog/what-is-idempotency)
